<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Control</title>
<link rel="icon" href="favicon.ico">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#fff; color:#333; }
  .topbar { background:#fff; padding:10px; display:flex; align-items:center; border-bottom:1px solid #eee; }
  .back { font-size:20px; margin-right:12px; cursor:pointer; color:#333; }
  .brand { height:40px; }
  .wrap { display:flex; flex-direction:column; align-items:center; padding:20px; gap:20px; }
  h2 { margin:10px 0; }
  .status { font-size:18px; color:#555; min-height:24px; }
  .icons { display:flex; gap:40px; margin-top:10px; }
  .icon { font-size:84px; color:#999; transition:all .3s; }
  .icon.bulb-on { color:#fde611; transform:scale(1.05); }
  .icon.fan-on { color:#ff8c00; animation:spin 1s linear infinite; }
  @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
  .mic-btn { background:#4caf50; color:white; border:none; padding:14px 24px; border-radius:50px; font-size:18px; cursor:pointer; }
  .mic-btn.active { background:#f44336; }
  .note { font-size:14px; color:#666; margin-top:8px; }
</style>
</head>
<body>
  <div class="topbar">
    <span class="back" onclick="location.href='index.html'"><i class="fas fa-arrow-left"></i></span>
    <img src="sastra_brand.jpg" class="brand" alt="brand">
  </div>

  <div class="wrap">
    <h2>Voice Command Control</h2>
    <button id="micBtn" class="mic-btn"><i class="fas fa-microphone"></i> Start</button>
    <div class="status" id="status">Speak: Turn on light, Turn off fan</div>

    <div class="icons">
      <i id="bulbIcon" class="fas fa-lightbulb icon"></i>
      <i id="fanIcon" class="fas fa-fan icon"></i>
    </div>

    <div class="note">-------Thankyou------</div>
  </div>

<script>
const ESP32_IP = "http://192.168.4.1";
const bulbIcon = document.getElementById("bulbIcon");
const fanIcon = document.getElementById("fanIcon");
const statusEl = document.getElementById("status");
const micBtn = document.getElementById("micBtn");

let bulbState = false;
let fanState = false;

function setBulb(on){
  bulbState = !!on;
  if(bulbState){ bulbIcon.classList.add("bulb-on"); } else { bulbIcon.classList.remove("bulb-on"); }
  fetch(`${ESP32_IP}/bulb?state=${bulbState ? "on":"off"}`).catch(()=>{});
}
function setFan(on){
  fanState = !!on;
  if(fanState){ fanIcon.classList.add("fan-on"); } else { fanIcon.classList.remove("fan-on"); }
  fetch(`${ESP32_IP}/fan?state=${fanState ? "on":"off"}`).catch(()=>{});
}

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if(SpeechRecognition){
  recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onstart = () => {
    statusEl.textContent = "I watch Speak";
    micBtn.classList.add("active");
  };
  recognition.onend = () => {
    statusEl.textContent = "Tap mic to speak";
    micBtn.classList.remove("active");
  };
  recognition.onerror = (e) => {
    statusEl.textContent = "Error: " + e.error;
  };
  recognition.onresult = (e) => {
    const transcript = e.results[0][0].transcript.toLowerCase();
    statusEl.textContent = "Heard: " + transcript;

    if(transcript.includes("light on") || transcript.includes("turn on light")){
      setBulb(true);
    } else if(transcript.includes("light off") || transcript.includes("turn off light")){
      setBulb(false);
    } else if(transcript.includes("fan on") || transcript.includes("turn on fan")){
      setFan(true);
    } else if(transcript.includes("fan off") || transcript.includes("turn off fan")){
      setFan(false);
    }
  };
} else {
  statusEl.textContent = "Speech not work";
}

micBtn.addEventListener("click", ()=>{
  if(recognition){
    recognition.start();
  }
});
</script>
</body>
</html>
